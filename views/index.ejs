<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
      .par {
        margin-left: auto;
        margin-right: auto;
        text-align: center;
      }
      .circle {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        font-size: 35px;
        line-height: 200px;
        text-align: center;
        background: #000;
        margin-right: 3%;
        margin-bottom: 3%;
        display: inline-block;
        border-color: #ffffff;
        border-width: 5px;
        border-style: solid;
      }
      .a1 {
        background: #c7eae4
      }
      .a2 {
        background: #a7e8bd
      }
      .a3 {
        background: #fcbcb8
      }
      .a4 {
        background: #efa7a7
      }
      .a5 {
        background: #ffd972
      }
      .bord {
        border-style: solid;
        border-width: 5px;
        border-color: #a0afab;
      }
    </style>
    <script>
      var availUsbs = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
      var usbIn = "";
      $(document).ready(function() {
        setInterval(() => {
          $.get('/usbin').done(function(data) {
            var availUsbsComp = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            for (var i = 0; i < data["usb"].length; i++) {
              var usbNum = data["usb"][i].charCodeAt(2) - 98;
              availUsbsComp[usbNum] = 1;
            }
            if (JSON.stringify(availUsbsComp) != JSON.stringify(availUsbs)) {
              var tagged = false;
              for (var i = 0; i < availUsbsComp.length; i++) {
                if (availUsbsComp[i] == 1) {
                  $("#usb" + (i + 1)).css("display", "block");
                  $("#usb" + (i + 1) + "div").css("display", "block");
                } else {
                  $("#usb" + (i + 1)).css("display", "none");
                  $("#usb" + (i + 1) + "div").css("display", "none");
                }
                if (availUsbsComp[i] == 1 && availUsbs[i] == 0) {
                  tagged = true;
                }
              }
              availUsbs = availUsbsComp;
              usbIn = tagged;
            }

          });
        }, 1000);
        setInterval(() => {
          for (var i = 0; i < availUsbs.length; i++) {
            if (availUsbs[i] == 1) {
              $.get('/status/' + i).done(function(data) {
                if (data["state"] != "done") {
                  $("#usb" + (data["num"] + 1) + "progress").css("width", (data["bytes_written"] / (16000000)) + "%");
                }
              });
            }
          }
        }, 1000);
        $(".circle").click(function() {
          if (usbIn) {
            var id = $(this).attr("id");
            $(".bord").removeClass("bord");
            $(this).addClass("bord");
            if (confirm("Are you sure you want to install " + id + "?")) {
              $.post('/install', { distro: id }).done(function(data) {
                if (!data.error) {
                  alert(id + " is being installed on your usb.");
                } else {
                  alert("There was an error processing your request.");
                }
              });
            }
          } else {
            alert("Please insert a USB drive");
          }
        });
      });
    </script>
  </head>
  <body>
  <% for (var i = 0; i < 10; i++) { %>
  <p id="usb<%= i + 1 %>" style="display: none">USB <%= i + 1 %></p>
  <div class="progress" id="usb<%= i + 1 %>div" style="display: none">
    <div class="progress-bar" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:70%" id="usb<%= i + 1 %>progress">
      <span class="sr-only">70% Complete</span>
    </div>
  </div>
  <% } %>
  <div class="par">
    <% count = 0; for (let val of distros) { %>
      <div class="circle a<%= (count % 5) + 1 %>" id="<%= val %>">
        <img class="distro-logo" alt="<%= val %>" src="/res/<%= val %>/logo.png">
      </div>
    <% count++; } %>
  </div>
  </body>
</html>
